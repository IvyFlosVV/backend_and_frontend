<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ivy AI Chat</title>
    <style>
        /* 1. The Specific Pastel Flowing Background (鹅黄, 浅蓝, 浅粉) */
        body, html {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            /* 鹅黄 (#fff1a8), 浅蓝 (#aed9e0), 浅粉 (#ffcdd2) */
            background: linear-gradient(120deg, #aed9e0, #ffcdd2, #fff1a8, #aed9e0);
            background-size: 300% 300%;
            animation: pastelFlow 12s ease-in-out infinite;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden; /* Prevents scrollbars on body */
        }

        @keyframes pastelFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* 2. The Unified Frosted Glass Container */
        /* 重点：所有的玻璃效果都在这里，里面的元素背景透明 */
        #ivy-bot-container {
            width: 450px;
            height: 650px; /* Slightly taller */
            /* Uniform glass effect for the WHOLE box */
            background: rgba(255, 255, 255, 0.35); 
            backdrop-filter: blur(40px) saturate(120%); /* Stronger blur for unity */
            -webkit-backdrop-filter: blur(40px) saturate(120%);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 28px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        /* Custom scrollbar */
        #chat-display::-webkit-scrollbar { width: 6px; }
        #chat-display::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.4); border-radius: 10px; }
    </style>
</head>
<body>

<div id="ivy-bot-container">
    <div style="
        padding: 18px 22px; 
        background: transparent; /* Critical for unified look */
        border-bottom: 1px solid rgba(255, 255, 255, 0.3); /* Subtle divider */
        display: flex; align-items: center; gap: 8px;">
        <div style="width: 12px; height: 12px; background: #ff6b6b; border-radius: 50%; box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);"></div>
        <div style="width: 12px; height: 12px; background: #ffd93d; border-radius: 50%; box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);"></div>
        <div style="width: 12px; height: 12px; background: #6bcb77; border-radius: 50%; box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);"></div>
        <span style="font-family: 'JetBrains Mono', monospace; font-size: 13px; color: #444; margin-left: auto; font-weight: 600; letter-spacing: 0.5px;">ivy_ai.exe</span>
    </div>

    <div id="chat-display" style="flex-grow: 1; overflow-y: auto; padding: 22px; display: flex; flex-direction: column; gap: 18px;">
        <div style="align-self: flex-start; max-width: 85%; padding: 14px 18px; background: rgba(255, 255, 255, 0.8); color: #2d3436; border-radius: 22px 22px 22px 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); font-size: 15px; line-height: 1.5;">
            Hi there! I'm the AI version of Ivy. Want to know about my latest projects in Stats & ML, or my thoughts on the humanities? Ask away!
        </div>
    </div>

    <div style="
        padding: 20px; 
        background: transparent; /* Critical for unified look */
        border-top: 1px solid rgba(255, 255, 255, 0.3); /* Subtle divider */
        display: flex; gap: 10px; position: relative;">
        
        <input type="text" id="user-msg" placeholder="Ask me something..." style="
            flex-grow: 1; 
            padding: 14px 20px; 
            border-radius: 30px; 
            border: 1px solid rgba(255,255,255,0.5);
            background: rgba(255,255,255,0.5); /* Slightly more opaque input */
            outline: none;
            font-size: 15px;
            color: #333;
            backdrop-filter: blur(5px);">
        
        <button onclick="askIvy()" id="send-btn" style="
            background: rgba(255, 255, 255, 0.85); 
            color: #444; 
            border: none; 
            padding: 0 24px; 
            border-radius: 30px; 
            cursor: pointer;
            font-weight: 700;
            font-size: 13px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: all 0.2s;">
            SEND
        </button>
    </div>
    <p id="status-msg" style="position: absolute; bottom: 75px; width: 100%; text-align: center; font-size: 11px; color: #666; margin: 0; display: none; font-family: 'JetBrains Mono', monospace;">
        Thinking...
    </p>
</div>

<script>
// (JS Code remains mostly the same, just slightly better bubble styling)
async function askIvy() {
    const input = document.getElementById('user-msg');
    const display = document.getElementById('chat-display');
    const status = document.getElementById('status-msg');
    const btn = document.getElementById('send-btn');
    const message = input.value.trim();

    if (!message) return;

    // User Message Bubble (Darker, glassy)
    display.innerHTML += `
        <div style="align-self: flex-end; max-width: 85%; padding: 14px 18px; background: rgba(45, 52, 54, 0.8); color: white; border-radius: 22px 22px 4px 22px; font-size: 15px; backdrop-filter: blur(5px); line-height: 1.5; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
            ${message}
        </div>`;
    
    input.value = '';
    status.style.display = 'block';
    btn.disabled = true;
    btn.style.opacity = "0.5";
    display.scrollTop = display.scrollHeight;

try {
        const response = await fetch('https://backend-and-frontend-3clh.onrender.com/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: message })
        });
        const data = await response.json();
        
        if (data.reply) {
            display.innerHTML += `
                <div style="align-self: flex-start; max-width: 85%; padding: 14px 18px; background: rgba(255, 255, 255, 0.8); color: #2d3436; border-radius: 22px 22px 22px 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); font-size: 15px; line-height: 1.5;">
                    ${data.reply}
                </div>`;
        } else if (data.error) {
            display.innerHTML += `<div style="color: #ff6b6b; font-size: 13px; text-align: center; font-weight: bold; margin: 10px 0; word-wrap: break-word;">Backend Error: ${data.error}</div>`;
        }
    } catch (err) {
        display.innerHTML += `<div style="color: #ff6b6b; font-size: 13px; text-align: center; font-weight: bold; margin: 10px 0;">⚠️ Connection error. Server might be waking up, try again in 1 minute!</div>`;
    } finally {
        status.style.display = 'none';
        btn.disabled = false;
        btn.style.opacity = "1";
        display.scrollTop = display.scrollHeight;
    }
}

document.getElementById('user-msg').addEventListener('keypress', (e) => { if(e.key === 'Enter') askIvy(); });
</script>
</body>
</html>